<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cdtu.mapper.StudentSignInMapper">
	<insert id="insertAll">
		INSERT INTO student_sign_in (ss_id, ps_id, s_id)
		VALUES
		<foreach collection="list" item="item" separator=",">
			(#{item.ssId}, #{item.psId}, #{item.sId})
		</foreach>
	</insert>

	<update id="updateStudentSignIn">
		UPDATE student_sign_in SET ss_status = 1,
		ss_mark = IF(NOW() > (SELECT s_late_time FROM publish_sign_in
		WHERE ps_id = #{psId}), '迟到', '已签'), ss_time = NOW()
		WHERE ps_id = #{psId}
		AND s_id = #{sId}
	</update>
	
	<select id="selectByPsId" resultType="java.util.HashMap">
		SELECT student.s_id, s_img_src, s_name, ss_status, ss_time
		FROM student_sign_in, student
		WHERE ps_id = #{psId}
		AND student.s_id = student_sign_in.s_id
	</select>

	<select id="selectByPsIdAndSId" resultType="java.util.HashMap">
		SELECT ss_status AS ssStatus, ss_mark AS mark
		FROM student_sign_in
		WHERE ps_id = #{psId}
		AND s_id = #{sId}
	</select>
	
	<select id="selectStatus" resultType="java.lang.Boolean">
		SELECT ss_status
		FROM student_sign_in
		WHERE ps_id = #{psId}
		AND s_id = #{sId}
	</select>
</mapper>